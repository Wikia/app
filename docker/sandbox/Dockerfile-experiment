# This is a base Docker image used in prod/sandbox/preview Jenkinsfile
FROM artifactory.wikia-inc.com/sus/php-wikia-base:da4390f

ADD app /usr/wikia/slot1/current/src
ADD config /usr/wikia/slot1/current/config

ADD ./php-fpm.conf /usr/local/etc/php-fpm.d/zz-www.conf

# WIKIA_ENVIRONMENT and WIKIA_DATACENTER - needed for maintenance scripts to run, but they are not used by rebuildLocalisationCache.php
RUN mkdir -p /usr/wikia/slot1/current/cache/messages && \
  chmod 777 /usr/wikia/slot1/current/cache/messages && \
  WIKIA_ENVIRONMENT=prod WIKIA_DATACENTER=sjc SERVER_ID=177 php maintenance/rebuildLocalisationCache.php --threads=16

USER nobody
