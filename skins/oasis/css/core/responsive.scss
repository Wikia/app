@import "color";
@import "layout";
@import "../mixins/box-sizing";
@import "resources/wikia/libraries/bourbon/bourbon";

$height-background-image: get_command_line_param( "background-image-height", 0 );
$width-background-image: get_command_line_param( "background-image-width", 0 );
$width-background-image-gradient: 40px;
$width-background-image-half: $width-background-image / 2;

$background-position: absolute;
@if ( $background-fixed == true ) {
	$background-position: fixed;
}

$width-adskin: 170px;
$width-adskins: $width-adskin * 2;
$width-outside-half: $width-outside / 2;
$width-outside-min: 768px;
$width-outside-max: 1600px;
$width-outside-max-half: $width-outside-max / 2;
$width-padding: $width-gutter / 2;

// The fluid background will be disabled if:
// - The background image is tiled.
// - The background image height is zero.
// - The background image width is less than the default skin width.
$is-fluid-width-background-enabled: true;
@if ( $background-tiled == true or $height-background-image == 0 or $width-background-image < $width-outside ) {
	$is-fluid-width-background-enabled: false;

} @else {

	// The offset, from the left and right sides of the viewport, that the images need
	// to align correctly to the sides of the skin before the max width has been set.
	$offset-background-image: ( ( $width-background-image-half - $width-adskin ) * 2 - $width-outside ) / 2;

	// The width of each "slice" of the background image while the offset above is applied.
	$width-background-image-slice: $width-background-image-half - $offset-background-image;

	// The offset, from the left and right sides of the viewport, that the image background
	// gradient needs to align correctly to the inner edges of the slices of background images
	$offset-background-image-gradient: $width-background-image-slice - $width-background-image-gradient;

	// The offset, from the center of the viewport, that the images need to align correctly
	// to the side of the skin after max width has been set.
	$offset-background-image-max: $width-outside-max-half + ( $width-background-image-half - $width-outside-half );

	// The offset, from the center of the viewport, that the image background gradient needs to align
	// correctly to the inner edges of the slices of background images after max width has been set.
	$offset-background-image-gradient-max: $offset-background-image-max - $width-background-image-half + $width-background-image-gradient;
}

body {
	min-width: $width-outside-min;

	@if ( $is-fluid-width-background-enabled ) {
		background: $color-body;
		overflow-x: hidden;

		&:after,
		&:before {
			background-image: url( $background-image ); /* $wgCdnStylePath */
			background-repeat: no-repeat;
			content: "";
			height: $height-background-image;
			position: $background-position;
			top: 0;
			width: $width-background-image-half;
			z-index: -2;
		}

		&:after {
			background-position: -#{ $width-background-image-half } 0;
			right: 50%;
			margin-right: -#{ $width-background-image-half };
		}

		&:before {
			background-position: 0;
			left: 50%;
			margin-left: -#{ $width-background-image-half };
		}
	}
}

body > .global-notification,
.WikiaHeader .page-width-container,
.WikiaPage {
	max-width: $width-outside-max;
}

.global-notification,
.WikiaHeader .page-width-container {
	@include box-sizing( border-box );
	width: $width-outside;
}

.WikiaActivityModule {
	li em {
		font-size: 15px;
		line-height: 18px;
		width: auto;
	}

	.edited-by {
		font-size: 12px;
	}
}

.WikiaArticle {
	font-size: 14px;
	line-height: 22px;

	h2 {
		font-size: 20px;
	}

	h3 {
		font-size: 17px;
	}

	h4 {
		font-size: 15px;
	}

	li {
		line-height: 22px;
	}

	.editsection {
		font-size: 14px;

		img {
			margin-right: 1px;
		}
	}

	.thumbcaption {
		line-height: 20px;
	}
}

.WikiaPageHeader {
	h1 {
		font-size: 28px;
		line-height: 28px;
	}
}

.WikiaArticle,
.WikiaArticleFooter {
	padding: 0;
}

.WikiaArticle .toc {
	#toctitle {
		h2 {
			font-size: 16px;
		}

		.toctoggle {
			font-size: 13px;
		}
	}

	ul li {
		line-height: 20px;
	}
}

.tally {
	font-size: 9px;
	line-height: 1.5em;

	em {
		font-size: 28px;
		margin-right: 3px;
	}
}

.WikiHeader {
	.navbackground {
		width: 100%;
	}

	.WikiNav {
		right: -4px;
		width: auto;

		.subnav-2 {
			width: auto;
		}
	}
}

.WikiHeaderSearch {
	display: none;
}

.WikiaHeader {
	min-width: 0;
}

.WikiaMainContent {
	margin-right: -#{ $width-rail + $width-gutter };
	position: static;
	width: 100%;
}

.WikiaMainContentContainer {
	background-color: $color-page;
	margin-right: $width-rail + $width-padding;
	padding: 0 $width-padding;
}

.WikiaPageHeader,
.wikinav2 .WikiaPageHeader {
	margin: 0 0 $width-padding 0;
	padding-bottom: $width-padding / 2;

	.wikia-menu-button,
	> .comments {
		margin-top: 3px;
	}
}

.WikiaRail {
	overflow: hidden;
	padding: 0 10px 0 0;

	.module h1,
	#RIGHT_SKYSCRAPER h1,
	.module h2,
	#RIGHT_SKYSCRAPER h2 {
		font-size: 20px;
		font-weight: normal;
		padding-left: 0;
	}

	.module .more {
		font-size: 11px;
	}
}

@media screen and (max-width: 1023px) {
	.WikiaArticle {
		min-height: auto;
	}

	.WikiaMainContent {
		float: none;
		margin-right: 0;
	}

	.WikiaMainContentContainer {
		margin-right: 0;
	}

	.WikiaRail {
		float: none;
		padding: 0 10px;
		width: auto;
	}

	.WikiaHeader li.start-a-wiki {
		display: none;
	}

	.WikiHeader {
		min-height: 154px;
		padding-top: 0;

		> nav {
			left: 0;
			top: 85px;
		}

		.buttons {
			top: 87px;
		}
	}

	.WikiNav li.nav-item:first-child {
		margin-left: 10px;
	}

	.WikiHeaderSearch {
		display: block;
		left: 280px;
		position: absolute;
		right: 10px;
		top: 12px;
		width: auto;

		input[type="text"] {
			@include box-sizing( border-box );
			font-size: 15pt;
			height: 40px !important;
			left: 0;
			margin-right: 0;
			position: absolute;
			right: 53px;
			width: auto;
			width: calc(100% - 53px); // <-- CSS3!
		}

		.wikia-button {
			height: 40px !important;
			position: absolute;
			right: 0;
		}
	}

	.WikiaRail .WikiaSearch {
		display: none;
	}
}

@media screen and (max-width: $width-outside) {
	body {
		background: $color-page;

		&:after,
		&:before {
			display: none;
		}
	}

	.WikiHeader .WikiNav {
		right: 0;

		.navbackground img {
			display: none;
		}
	}

	.global-notification,
	.WikiaHeader .page-width-container {
		width: auto;
	}

	.WikiaPage {
		border: 0;
		width: auto;
	}

	.WikiaPageBackground {
		display: none;
	}

	.WikiaTopAds {
		width: 100%;
	}
}

@media screen and (min-width: $width-outside + $width-adskins) {
	body > .global-notification,
	.WikiaHeader .page-width-container,
	.WikiaPage {
		margin: 0 $width-adskin;
		width: auto;
	}

	@if ( $is-fluid-width-background-enabled ) {
		body {
			&:after,
			&:before {
				width: $width-background-image-slice;
			}

			&:after {
				background-position: -#{ $width-background-image-half } 0;
				margin-right: 0;
				right: 0;
			}

			&:before {
				background-position: -#{ $offset-background-image } 0;
				margin-left: 0;
				left: 0;
			}
		}

		.background-image-gradient {
			&:after,
			&:before {
				content: "";
				height: 100%;
				position: fixed;
				top: 0;
				width: $width-background-image-gradient;
				z-index: -1;
			}

			&:after {
				@include linear-gradient( to left, rgba( $color-body, 0 ) 0%, $color-body 100% );
				right: $offset-background-image-gradient;
			}

			&:before {
				@include linear-gradient( to right, rgba( $color-body, 0 ) 0%, $color-body 100% );
				left: $offset-background-image-gradient;
			}
		}
	}
}

@media screen and (min-width: $width-outside-max + $width-adskins) {
	body > .global-notification,
	.WikiaHeader .page-width-container,
	.WikiaPage {
		margin: 0 auto;
	}

	@if ( $is-fluid-width-background-enabled ) {
		body {
			&:after,
			&:before {
				width: $width-background-image-half;
			}

			&:after {
				background-position: -#{ $width-background-image-half } 0;
				right: 50%;
				margin-right: -#{ $offset-background-image-max };
			}

			&:before {
				background-position: 0;
				left: 50%;
				margin-left: -#{ $offset-background-image-max };
			}
		}

		.background-image-gradient {
			&:after {
				margin-right: -#{ $offset-background-image-gradient-max };
				right: 50%;
			}

			&:before {
				left: 50%;
				margin-left: -#{ $offset-background-image-gradient-max };
			}
		}
	}
}