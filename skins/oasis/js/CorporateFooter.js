require(['JSMessages', 'wikia.cookies', 'wikia.tracker', 'jquery', 'wikia.querystring', 'wikia.window'], function(msg, cookies, tracker, $, Querystring, window){
	/**
	 * If the pageview is generated by a conversion from the mobile skin then show a link to go back to it
	 */

	var linksWrapper = $('.CorporateFooter ul').first();

	if($().isTouchscreen() && linksWrapper.exists()){
		msg.get('Oasis-mobile-switch').then(function(){
			var mobileSwitch = $('<li><a href="#">' + msg('oasis-mobile-site') + '</a></li>');

			mobileSwitch.on('click', function(ev){
				ev.preventDefault();
				ev.stopPropagation();

				//This is being depracted remove when Varnish will be updated to use useskin
				cookies.set('mobilefullsite', null);//invalidate cookie

				cookies.set('useskin', 'wikiamobile', {
					domain: window.wgCookieDomain,
					path: window.wgCookiePath
				});

				tracker.track({
					category: 'corporate-footer',
					action: tracker.ACTIONS.CLICK_LINK_BUTTON,
					label: 'mobile-switch',
					trackingMethod: 'both'
				});


				Querystring().setVal('useskin', 'wikiamobile').addCb().goTo();
			});

			linksWrapper.append(mobileSwitch);
		});
	}
});
